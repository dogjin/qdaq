<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QDaq: QDaq scripting API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QDaq
   &#160;<span id="projectnumber">v0.2.6</span>
   </div>
   <div id="projectbrief">Qt-based Data Aqcuisition</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">QDaq scripting API</div>  </div>
</div><!--header-->
<div class="contents">

<p>A Javascript API for QDaq based on QtScript.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for QDaq scripting API:</div>
<div class="dyncontent">
<div class="center"><img src="group___script_a_p_i.png" border="0" usemap="#group______script__a__p__i" alt=""/></div>
<map name="group______script__a__p__i" id="group______script__a__p__i">
<area shape="rect" href="group___core.html" title="Classes that define the core functionality of QDaq objects." alt="" coords="286,57,423,82"/>
<area shape="rect" title="A Javascript API for QDaq based on QtScript." alt="" coords="5,82,140,107"/>
<area shape="rect" href="group___daq.html" title="Classes that can be used for data aqcuisition tasks." alt="" coords="285,106,424,131"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_byte_array_prototype.html">ByteArrayPrototype</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The prototype for the ByteArray class.  <a href="class_byte_array_prototype.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_channel.html">QDaqChannel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class that represent a stream of numerical data, a signal.  <a href="class_q_daq_channel.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_data_buffer.html">QDaqDataBuffer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class that provides storage of channel or other data.  <a href="class_q_daq_data_buffer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_job.html">QDaqJob</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class for objects that perform a specific task reqursively.  <a href="class_q_daq_job.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_loop.html">QDaqLoop</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class encapsulating a software loop.  <a href="class_q_daq_loop.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_object.html">QDaqObject</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class of all QDaq objects.  <a href="class_q_daq_object.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_vector_prototype.html">VectorPrototype</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The prototype for the Vector class.  <a href="class_vector_prototype.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_q_daq_device.html">QDaqDevice</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A class representing a DAQ device.  <a href="class_q_daq_device.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A Javascript API for QDaq based on QtScript. </p>
<p>QDaq offers a Javascript interface via the QtScript module.</p>
<p>One can use this scripting interface either to allow some user-defined behavior at some point inside a larger C++ application or alternatively to build the complete application in the scripting language.</p>
<p>It is possible to create QDaq objects from Javascript. These objects will continue to exist after the scripting session ends, as long as they become part of the QDaq object tree. Thus, complete aqcuisition loops can be created and executed in javascript in the same way as in C++.</p>
<p>Creation of GUI components and interaction between them and the QDaq objects can also be done using Javascript.</p>
<p>The scripting interface is based on the Qt meta-object system. When a QDaq object is exposed to the scripting environment, the signals and slots the QDaqObject-based class are available as methods of the javascript object. These methods can be called from javascript with the same arguments as in C++.</p>
<p>Similarly, the Qt properties of the C++ class become properties of the javascript object and can be read or changed from Javascript.</p>
<p>QDaq objects has been designed so that the API they offer to Javascript (i.e., their signals, slots and properties) are sufficient to work with the objects for most purposes. Only a few special functions or QDaq extensions are acomplished only in C++.</p>
<p>The QDaq class documentation serves also as documentation of the scripting API as far as the signals, slots and properties of each class are concerned.</p>
<h1><a class="anchor" id="Started"></a>
Getting started with QDaq scripting</h1>
<p>The easiest way to get started with QDaq scripting is to start the <a class="el" href="qdaq_app.html">qdaq</a> application, open a scripting console and start executing Javascript commands interactively.</p>
<p>The QDaq root object (<a class="el" href="class_q_daq_object.html#a9f3d71496598a421c34fc099bcfcb1ae" title="Obtain a pointer to the one-and-only QDaqRoot object.">QDaqObject::root()</a>) is already defined in Javascript as the global property "qdaq".</p>
<p>If you type "qdaq" at the prompt and press enter the system reponds by showing that this is an object of class <a class="el" href="class_q_daq_root.html" title="QDaq root object class.">QDaqRoot</a> with name "qdaq". Similarly if you check the "this" object the system reponds that it is an object of class QDaqSession:</p>
<pre class="fragment">&gt;&gt; qdaq
QDaqRoot(name = "qdaq")
&gt;&gt; this
QDaqSession(name = "session0")
&gt;&gt;
</pre><p>You will notice that the console has object introspection, i.e., pressing the '.' after a valid Javascript expression the system lists all properties and method of a given object.</p>
<h1><a class="anchor" id="Create"></a>
Creating objects in scripts</h1>
<p>All the classes <a href="#nested-classes">listed above </a> can be created in the scripting environment by the Javascript new operator with a single parameter, the object name</p>
<div class="fragment"><div class="line">var x = new QDaqObject(&quot;objname&quot;);</div>
</div><!-- fragment --><p>A hierarchy of QDaq objects can be built by using the <a class="el" href="class_q_daq_object.html" title="Base class of all QDaq objects.">QDaqObject</a> <a class="el" href="class_q_daq_object.html#domapi">domapi</a>. Here is an example of script code that creates a loop with 2 channels:</p>
<div class="fragment"><div class="line">// create a loop</div>
<div class="line">var loop = new QDaqLoop(&quot;loop&quot;);</div>
<div class="line">// create a clock channel</div>
<div class="line">var t = new QDaqChannel(&quot;t&quot;);</div>
<div class="line">t.type = &quot;Clock&quot;;</div>
<div class="line">// create a test random channel</div>
<div class="line">var ch1 =  new QDaqChannel(&quot;ch1&quot;);</div>
<div class="line">ch1.type = &quot;Random&quot;;</div>
<div class="line">// create a 2nd channel</div>
<div class="line">var ch2 = new QDaqChannel(&quot;ch2&quot;);</div>
<div class="line">// create a script job</div>
<div class="line">// that will write to ch2 the square root of ch1</div>
<div class="line">var scr = new QDaqJob(&quot;scr&quot;);</div>
<div class="line">scr.code = &quot;var v = qdaq.loop.ch1.value(); qdaq.loop.ch2.push(Math.sqrt(v));&quot;</div>
<div class="line">// build the object hierarchy under the root object &quot;qdaq&quot;</div>
<div class="line">loop.appendChild(t);</div>
<div class="line">loop.appendChild(ch1);</div>
<div class="line">loop.appendChild(scr);</div>
<div class="line">loop.appendChild(ch2);</div>
<div class="line">qdaq.appendChild(loop);</div>
</div><!-- fragment --><p>After the above script code has been executed a call to objectTree() would return the following: </p><pre class="fragment">&gt;&gt; qdaq.objectTree()
qdaq
|--loop
|  |--t
|  |--ch1
|  |--scr
|  |--ch2
</pre><h1><a class="anchor" id="Hierarchy"></a>
Traversing the object hierarchy</h1>
<p>The are many ways to traverse the QDaq object hierarchy from Javascript.</p>
<p>All objects are descendants of the root object "qdaq". The child objects of an object are Javascript properties of that object. Thus, in the above example we can obtain the object "ch2" like this</p>
<div class="fragment"><div class="line">var my_ch2 = qdaq.loop.ch2;</div>
</div><!-- fragment --><p>Alternatively, if we do not know the path to the object, we can use the built-in QtScript functions findChild and findChildren which try to find an object based on its name. All QDaq object must have a name! Thus, to obtain "ch2" with this method we would do</p>
<div class="fragment"><div class="line">var my_ch2 = qdaq.findChild(&quot;ch2&quot;);</div>
</div><!-- fragment --><p>If there are more than one descendant objects with the same name, findChild() will return the 1st that it will find (closer relatives are discovered first). The function findChildren will return an array of all objects with the same name.</p>
<h1><a class="anchor" id="Threads"></a>
Interactive vs in-loop Javascript</h1>
<p>There two different kinds of Javascript environments in QDaq.</p>
<p>The 1st one runs in the main application thread and can execute either interactively on a console or in the background running some script. This kind of environment has typically access to all application objects: the QDaq object hierarchy, the UI widgets, the special functions for system interaction (filesystem, command execution) etc</p>
<p>QDaq has one standard such Javascript environment that is never deleted and it is called "root script session". It can be accesed by the function <a class="el" href="class_q_daq_root.html#ae5bed36b118927b2c910e8d7dba3fc10" title="Returns a pointer to the root script session.">QDaqRoot::rootSession()</a>. If we need to define Jacascript functions that must exist throught the lifetime of the application, then we have to define them in the root session. A typical example of such a function is when we want to define UI logic in Javascript, e.g. a button press calls a Javascript funtion that performs the required action.</p>
<p>A second kind of Javascript environment exists only within a <a class="el" href="class_q_daq_loop.html" title="A class encapsulating a software loop.">QDaqLoop</a> and it serves the purpose of running code of the loop's <a class="el" href="class_q_daq_job.html" title="Base class for objects that perform a specific task reqursively.">QDaqJob</a> objects. This environment runs in the separate loop thread and has only access to the QDaq objects via the qdaq global object.</p>
<p>If we have <a class="el" href="class_q_daq_job.html" title="Base class for objects that perform a specific task reqursively.">QDaqJob</a> objects that need to run Javascript code during execution of their parent loop, then we must create a scripting engine at the top-level loop by calling <a class="el" href="class_q_daq_loop.html#a599396e9e90ad42df14aa1157f169e46" title="Create a dedicated QDaqScriptEngine.">QDaqLoop::createLoopEngine()</a>.</p>
<h1><a class="anchor" id="UI"></a>
Creating user interface (UI) components</h1>
<p>In Javascript UI components can be loaded from *.ui files that have been created by QtDesigner or QtCreator.</p>
<p>There are 2 functions to accomplish this: QDaqSession::loadUi() and QDaqSession::loadTopLevelUi().</p>
<p>Both take a *.ui file name as input and generate a QWidget according to the specifications in the file. The simple loadUi() function generates a bare QWidget whereas loadTopLevelUi() generates a top level QDaq window. Using these two functions, a complete UI can be built. This is shown in the following code example.</p>
<p>The main application window is a tab widget with 2 tabs. We create it in QtDesigner and give each of the tabs a representative name. The form we create in QtDesigner should be a plain QWidget or a QTabWidget. Do not use a QMainWindow or other top-level widget types.</p>
<p>We additionally create in QtDesigner two widgets that contain all the components (buttons, display fields, etc) that we need in each tab.</p>
<p>The following QDaq script code creates the widgets and combines them to form the final application window.</p>
<div class="fragment"><div class="line">// create top level application window - a tab widget</div>
<div class="line">var w = loadTopLevelUi(&#39;tabwidget.ui&#39;,&#39;mainForm&#39;);</div>
<div class="line">// create the widget for the 1st tab</div>
<div class="line">var to = loadUi(&#39;tab1.ui&#39;);</div>
<div class="line">// find the current 1st tab widget in the main window</div>
<div class="line">var from = w.findChild(&#39;tab1&#39;);</div>
<div class="line">// replace it with the one loaded from the file</div>
<div class="line">w.replaceWidget(from,to);</div>
<div class="line">// repeat for the second tab</div>
<div class="line">to = loadUi(&#39;tab2.ui&#39;);</div>
<div class="line">from = w.findChild(&#39;tab2&#39;);</div>
<div class="line">w.replaceWidget(from,to);</div>
</div><!-- fragment --><p>To be able to locate the various UI components we have to give them a name in QtDesigner. Then, when a form is loaded in Javascript, use findChild() or findChildren() to get the UI widgets.</p>
<h1><a class="anchor" id="FullApp"></a>
Creating a full app in Javascript</h1>
<p>To create a full QDaq application in Javascript the following steps are needed:</p><ul>
<li>Create the user interface forms with QtDesigner or QtCreator</li>
<li>Write a script that loads the UI files and defines the UI logic</li>
<li>Implement the main application DAQ tasks by means of QDaq objects</li>
<li>Start your QDaq loops</li>
</ul>
<p>The application can be executed with the <a class="el" href="qdaq_app.html">qdaq</a> application.</p>
<p>A recomended folder organization is to have a root folder with the application name, a subfolder named "scripts" for the script files and a subfolder named "ui" for the *.ui files. Then <a class="el" href="qdaq_app.html">qdaq</a> is run from the root folder </p><div class="fragment"><div class="line">&gt;qdaq scripts/main.js</div>
</div><!-- fragment --><p> assuming that "main.js" is the application script.</p>
<p>QDaq will create a "log" subfolder to store its log files.</p>
<h1><a class="anchor" id="Extensions"></a>
QDaq Javascript tricks</h1>
<p>QDaq defines some special Javascript objects.</p>
<p>The <a class="el" href="class_byte_array_prototype.html" title="The prototype for the ByteArray class.">ByteArrayPrototype</a> class defines essentially a new Javascript object class named "ByteArray" that allows low-level manipulation of arrays of bytes. This is usefull for DAQ work, when we need byte-wise memory access which is not possible by default in Javascript.</p>
<p>C++ Enumeration types that are properties of QDaq objects are manipulated from Javascript by strings with the enumeration name that appears in C++ code. E.g., to set the <a class="el" href="class_q_daq_channel.html#aeedd7ab3fa27546657492724e32c85d7" title="Option for formatting channel data for textual representation.">QDaqChannel::format</a> property we pass a string</p>
<div class="fragment"><div class="line">// Create a QDaq channel and set the number format to fixed point</div>
<div class="line">var ch = new QDaqChannel(&quot;ch1&quot;);</div>
<div class="line">ch.format = &quot;FixedPoint&quot;;</div>
</div><!-- fragment --><h1><a class="anchor" id="Ref"></a>
Further reading</h1>
<p>For QDaq objects and their Javascript API refer to the documentation of the <a href="#nested-classes">classes listed above</a> and other QDaq classes. All properties, signals and slots are available in Javascript and essentially constitute the QDaq Scripting API.</p>
<p>Resources for Javascript and QtScript:</p><ul>
<li>An excellent book for Javascript is "JavaScript: the definitive guide" by D. Flanagan.</li>
<li>Mozilla offers many Javascript resources at <a href="https://developer.mozilla.org/en-US/docs/Web/javascript">developer.mozilla.org.</a></li>
<li>Also the W3 organization has Javascript material here <a href="https://www.w3schools.com/js/DEFAULT.asp">www.w3schools.com.</a></li>
<li>The QtScript module documentation from the official Qt web-site <a href="https://doc.qt.io/qt-5/qtscript-index.html">doc.qt.io.</a> explains many implementation details on the C++/Javascript duality.</li>
<li>The QtScript Javascript engine implements the ECMA-262 language standard which is described <a href="https://doc.qt.io/qt-5/ecmascript.html">here.</a> </li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri May 22 2020 17:09:16 for QDaq by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
